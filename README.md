# Аллокатор пам'яті загального призначення
### Вхідні парамтери
- Розмір сторінки (PAGE_SIZE) 4096 або 4 кб
- Розмір заголовку сторіки 1 байт (тип bool), який використовується для визначення, вільний чи зайнятий блок
- Мінімальний розмір блоку (MINIMAL_BLOCK_SIZE) 16 байт або 2 ^ 4, наступні блоки - 2 ^ x, де x> = 4
- Загальний обсяг памяті 4096 * 3 = 12,228 або 12kb, отже, за допомогою цієї пам'яті можна створити 3 сторінки


### Опис заголовка сторінки
#### Статус (state)
- Вільний (Free), якщо сторінка не була аллокована
- Розділена на блоки (DividedIntoBlocks), якщо розмір виділеної пам'яті менше або дорівнює (розмір сторінки) / 2
- Занята багатосторінковим блоком(MultipageBlock), якщо розмір виділеної пам'яті перевищує (розмір сторіки) / 2
#### Розмір блоку (bsize)
- Вказує розмір пам'яті у кожного блоку сторінки
#### Кількість блоків (blocksAmount)
- Вказує кількість блоків розміщених на сторінці.
#### Вказівник на наступний вільний блок (ptrToFirstFree)
- Містить вказівник на наступний вільний блок памяті на даній сторінці.
### Опис алгоритму
#### `void * mem_alloc (size_t size)` функція
Ця функція вирівнює `size` за формулою size = x && size <= 2^x, де x - cтепінь двійки.  
У випадку, коли `size <= PAGE_SIZE / 2`, функція здійснює пошук сторінки iз даним розміром блоку = х.  
Якщо такої сторінки не знайдено, функція шукає вільну сторінку та ділить її на блоки з відповідним розміром, створює заголовок, встановлюючи статус ="Розділена на блоки".  
Функція повертає `nullptr`, якщо вільних сторінок не знайдено.  
У випадку, коли `size> PAGE_SIZE / 2`, функція обчислює кількість сторінок, необхідних для зберігання такого великого блоку.  
Якщо кількість вільних сторінок більша або дорівнює необхідній кількості сторінок, тоді функція змінює заголовок, встановлюючи статус багатосторінкового блоку,  
розмір класу, що дорівнює розміру необхідного блоку.  
Якщо вільних сторінок недостатньо, повертається `nullptr`.  
У випадку успішного розподілу повертається адреса нового блоку.
#### `функція void mem_free (void * addr)`
Ця функція знаходить сторінку, яка містить `addr`, і перевіряє, чи є `addr` дійсним.  
У випадку, коли статус сторінки розділений, функція виставляє блок `addr` і перевіряє, чи вільний кожен блок,  
якщо так, функція змінює заголовок і додає сторінку до масиву вільних сторінок.  
Крім того, функція перевіряє, чи сторінка була заповнена, а потім додає сторінку до наявного масиву сторінок розбитих на блоки.  
Якщо статус сторінки є "Занята багатосторінковим блоком", функція змінює заголовки всіх сторінок, що містять блок `addr`, на вільний статус.
#### `функція void * mem_realloc (void * addr, size_t size)`
Ця функція перевіряє правильність `addr` та вирівнює `size` за формулою size = x && size <= 2^x, де x - cтепінь двійки.  
Функції здійснюють пошук на сторінці, яка містить блок із адресою, рівною `addr`.  
У випадку, коли статус сторінки "Розділена на блоки", функція викликає метод `mem_alloc (size)` та викликає `mem_free (addr)` при успішному розподілі.  
Функція повертає `addr`, якщо розподіл не вдався.   
У випадку, коли статус сторінки - багатосторінковий блок,  
функція обчислює кількість сторінок, необхідних для виділення нового блоку, розмір якого дорівнює `size`.  
Якщо старий і новий обсяг сторінок дорівнюють, повертається `addr`.  
Якщо `size> = PAGE_SIZE / 2`, тоді функція викликає` mem_free (addr) `, а потім викликає та повертає результат ` mem_alloc (size) `.  
Якщо стара кількість сторінок перевищує нову, функція вивільняє зайві сторінки та змінює розмір блоків інших сторінок.  
Якщо нова кількість сторінок перевищує стару, виділяє потрібну кількість вільних сторінок.
### Приклади
#### Приклад функції `mem_alloc (size_t size)`
##### Опис
Виділення 8080 байтів памяті
##### Код
``
uint8_t* x = mem_alloc(8080);
``
! [Виділити блок розміром 8080] (ex1.jpg "Виділити блок розміром 8080")
#### Приклад функції `mem_realloc (void * addr, size_t size)`
##### Опис
Релокуєм память із 8080 байт до 1024 байта.
##### Код
``
x = (uint8_t*)alloc.mem_realloc(x, 1024);
``
! [Реалокувати блок розміром 8080 до 1024] (ex2.jpg "Реалокувати блок розміром 8080 до 1024")
#### Приклад функції `mem_free (void * addr)`
##### Опис
Звільнення 1024-байтного блоку
##### Код
``
mem_free (x);
``
! [Звільнення 1024-байтного блоку] (ex3.png "Звільнення 1024-байтного блоку")
